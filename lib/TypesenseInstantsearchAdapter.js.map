{"version":3,"sources":["../src/TypesenseInstantsearchAdapter.js"],"names":["TypesenseInstantsearchAdapter","options","configuration","Configuration","validate","typesenseClient","TypesenseSearchClient","server","searchClient","search","instantsearchRequests","searchTypesenseAndAdapt","searchForFacetValues","searchTypesenseForFacetValuesAndAdapt","_adaptAndPerformTypesenseRequest","typesenseResponse","adaptedResponses","results","map","typesenseResult","index","_validateTypesenseResult","responseAdapter","SearchResponseAdapter","adapt","console","error","FacetSearchResponseAdapter","requestAdapter","SearchRequestAdapter","additionalSearchParameters","collectionSpecificSearchParameters","request","Error","code","hits","grouped_hits"],"mappings":"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","sourcesContent":["\"use strict\";\n\nimport { Configuration } from \"./Configuration\";\nimport { SearchClient as TypesenseSearchClient } from \"typesense\";\nimport { SearchRequestAdapter } from \"./SearchRequestAdapter\";\nimport { SearchResponseAdapter } from \"./SearchResponseAdapter\";\nimport { FacetSearchResponseAdapter } from \"./FacetSearchResponseAdapter\";\n\nexport default class TypesenseInstantsearchAdapter {\n  constructor(options) {\n    this.configuration = new Configuration(options);\n    this.configuration.validate();\n    this.typesenseClient = new TypesenseSearchClient(this.configuration.server);\n    this.searchClient = {\n      search: instantsearchRequests =>\n        this.searchTypesenseAndAdapt(instantsearchRequests),\n      searchForFacetValues: instantsearchRequests =>\n        this.searchTypesenseForFacetValuesAndAdapt(instantsearchRequests)\n    };\n  }\n\n  async searchTypesenseAndAdapt(instantsearchRequests) {\n    let typesenseResponse;\n    try {\n      typesenseResponse = await this._adaptAndPerformTypesenseRequest(\n        instantsearchRequests\n      );\n\n      const adaptedResponses = typesenseResponse.results.map(\n        (typesenseResult, index) => {\n          this._validateTypesenseResult(typesenseResult);\n          const responseAdapter = new SearchResponseAdapter(\n            typesenseResult,\n            instantsearchRequests[index]\n          );\n          return responseAdapter.adapt();\n        }\n      );\n\n      return {\n        results: adaptedResponses\n      };\n    } catch (error) {\n      console.error(error);\n      throw error;\n    }\n  }\n\n  async searchTypesenseForFacetValuesAndAdapt(instantsearchRequests) {\n    let typesenseResponse;\n    try {\n      typesenseResponse = await this._adaptAndPerformTypesenseRequest(\n        instantsearchRequests\n      );\n\n      const adaptedResponses = typesenseResponse.results.map(\n        (typesenseResult, index) => {\n          this._validateTypesenseResult(typesenseResult);\n          const responseAdapter = new FacetSearchResponseAdapter(\n            typesenseResult,\n            instantsearchRequests[index]\n          );\n          return responseAdapter.adapt();\n        }\n      );\n\n      return adaptedResponses;\n    } catch (error) {\n      console.error(error);\n      throw error;\n    }\n  }\n\n  async _adaptAndPerformTypesenseRequest(instantsearchRequests) {\n    const requestAdapter = new SearchRequestAdapter(\n      instantsearchRequests,\n      this.typesenseClient,\n      this.configuration.additionalSearchParameters,\n      this.configuration.collectionSpecificSearchParameters\n    );\n    const typesenseResponse = await requestAdapter.request();\n    return typesenseResponse;\n  }\n\n  _validateTypesenseResult(typesenseResult) {\n    if (typesenseResult.error) {\n      throw new Error(`${typesenseResult.code} - ${typesenseResult.error}`);\n    }\n    if (!typesenseResult.hits && !typesenseResult.grouped_hits) {\n      throw new Error(\n        `Did not find any hits. ${typesenseResult.code} - ${typesenseResult.error}`\n      );\n    }\n  }\n}\n"],"file":"TypesenseInstantsearchAdapter.js"}