{"version":3,"file":"Configuration.js","names":["_interopRequireDefault","require","Object","defineProperty","exports","value","Configuration","_classCallCheck2","_createClass2","_this$server$cacheSea","_options$additionalSe","_ref","_this$additionalSearc","_ref2","_this$additionalSearc2","_ref3","_this$additionalSearc3","_ref4","_this$additionalSearc4","_options$geoLocationF","_options$facetableFie","_options$collectionSp","_this","_options$flattenGroup","_options$facetByOptio","_options$filterByOpti","_options$sortByOption","_options$collectionSp2","_options$collectionSp3","_options$collectionSp4","_options$union","options","arguments","length","undefined","server","nodes","host","port","path","protocol","cacheSearchResultsForSeconds","additionalSearchParameters","query_by","queryBy","preset","sort_by","sortBy","highlight_full_fields","highlightFullFields","geoLocationField","facetableFieldsWithSpecialCharacters","collectionSpecificSearchParameters","keys","forEach","collection","_params$queryBy","_params$preset","_params$sortBy","_ref5","_ref6","_params$highlightFull","params","key","renderingContent","flattenGroupedHits","facetByOptions","filterByOptions","sortByOptions","collectionSpecificFacetByOptions","collectionSpecificFilterByOptions","collectionSpecificSortByOptions","union","validate","values","some","c","console","warn","Error"],"sources":["../src/Configuration.js"],"sourcesContent":["\"use strict\";\n\nexport class Configuration {\n  constructor(options = {}) {\n    this.server = options.server || {\n      nodes: [\n        {\n          host: \"localhost\",\n          port: \"8108\",\n          path: \"\",\n          protocol: \"http\",\n        },\n      ],\n    };\n\n    this.server.cacheSearchResultsForSeconds = this.server.cacheSearchResultsForSeconds ?? 2 * 60;\n\n    this.additionalSearchParameters = options.additionalSearchParameters ?? {};\n\n    this.additionalSearchParameters.query_by =\n      this.additionalSearchParameters.queryBy ?? this.additionalSearchParameters.query_by ?? \"\";\n\n    this.additionalSearchParameters.preset =\n      this.additionalSearchParameters.preset ?? this.additionalSearchParameters.preset ?? \"\";\n\n    this.additionalSearchParameters.sort_by =\n      this.additionalSearchParameters.sortBy ?? this.additionalSearchParameters.sort_by ?? \"\";\n\n    this.additionalSearchParameters.highlight_full_fields =\n      this.additionalSearchParameters.highlightFullFields ??\n      this.additionalSearchParameters.highlight_full_fields ??\n      this.additionalSearchParameters.query_by;\n\n    this.geoLocationField = options.geoLocationField ?? \"_geoloc\";\n    this.facetableFieldsWithSpecialCharacters = options.facetableFieldsWithSpecialCharacters ?? [];\n\n    this.collectionSpecificSearchParameters = options.collectionSpecificSearchParameters ?? {};\n\n    Object.keys(this.collectionSpecificSearchParameters).forEach((collection) => {\n      const params = this.collectionSpecificSearchParameters[collection];\n      params.query_by = params.queryBy ?? params.query_by;\n      params.preset = params.preset ?? params.preset;\n      params.sort_by = params.sortBy ?? params.sort_by;\n      params.highlight_full_fields =\n        params.highlightFullFields ??\n        params.highlight_full_fields ??\n        this.additionalSearchParameters.highlight_full_fields ??\n        params.query_by;\n\n      // Remove undefined values\n      Object.keys(params).forEach((key) => (params[key] === undefined ? delete params[key] : {}));\n    });\n\n    this.renderingContent = options.renderingContent;\n    this.flattenGroupedHits = options.flattenGroupedHits ?? true;\n    this.facetByOptions = options.facetByOptions ?? {};\n    this.filterByOptions = options.filterByOptions ?? {};\n    this.sortByOptions = options.sortByOptions ?? {};\n    this.collectionSpecificFacetByOptions = options.collectionSpecificFacetByOptions ?? {};\n    this.collectionSpecificFilterByOptions = options.collectionSpecificFilterByOptions ?? {};\n    this.collectionSpecificSortByOptions = options.collectionSpecificSortByOptions ?? {};\n    this.union = options.union ?? false;\n  }\n\n  validate() {\n    // Warn if camelCased parameters are used, suggest using snake_cased parameters instead\n    if (\n      this.additionalSearchParameters.queryBy ||\n      Object.values(this.collectionSpecificSearchParameters).some((c) => c.queryBy)\n    ) {\n      console.warn(\n        \"[typesense-instantsearch-adapter] Please use snake_cased versions of parameters in additionalSearchParameters instead of camelCased parameters. For example: Use query_by instead of queryBy. camelCased parameters will be deprecated in a future version.\" +\n          \" We're making this change so that parameter names are identical to the ones sent to Typesense (which are all snake_cased), and to also keep the types for these parameters in sync with the types defined in typesense-js.\",\n      );\n    }\n\n    /*\n     * Either additionalSearchParameters.query_by or additionalSearchParameters.preset needs to be set, or\n     *   All collectionSpecificSearchParameters need to have query_by or preset\n     *\n     * */\n    if (\n      this.additionalSearchParameters.query_by.length === 0 &&\n      this.additionalSearchParameters.preset.length === 0 &&\n      (Object.keys(this.collectionSpecificSearchParameters).length === 0 ||\n        Object.values(this.collectionSpecificSearchParameters).some(\n          (c) => (c.query_by || \"\").length === 0 && (c.preset || \"\").length === 0,\n        ))\n    ) {\n      throw new Error(\n        \"[typesense-instantsearch-adapter] Missing parameter: One of additionalSearchParameters.query_by or additionalSearchParameters.preset needs to be set, or all collectionSpecificSearchParameters need to have either .query_by or .preset set.\",\n      );\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}