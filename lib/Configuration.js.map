{"version":3,"file":"Configuration.js","names":["_classCallCheck","_createClass","Configuration","_this$server$cacheSea","_options$additionalSe","_ref","_this$additionalSearc","_ref2","_this$additionalSearc2","_ref3","_this$additionalSearc3","_ref4","_this$additionalSearc4","_options$geoLocationF","_options$facetableFie","_options$collectionSp","_this","_options$flattenGroup","_options$facetByOptio","_options$filterByOpti","_options$sortByOption","_options$collectionSp2","_options$collectionSp3","_options$collectionSp4","_options$union","_options$useOverrideT","_options$flipNegative","options","arguments","length","undefined","server","nodes","host","port","path","protocol","cacheSearchResultsForSeconds","additionalSearchParameters","query_by","queryBy","preset","sort_by","sortBy","highlight_full_fields","highlightFullFields","geoLocationField","facetableFieldsWithSpecialCharacters","collectionSpecificSearchParameters","Object","keys","forEach","collection","_params$queryBy","_params$preset","_params$sortBy","_ref5","_ref6","_params$highlightFull","params","key","renderingContent","flattenGroupedHits","facetByOptions","filterByOptions","sortByOptions","collectionSpecificFacetByOptions","collectionSpecificFilterByOptions","collectionSpecificSortByOptions","union","useOverrideTags","flipNegativeRefinementOperator","value","validate","values","some","c","console","warn","Error"],"sources":["../src/Configuration.js"],"sourcesContent":["\"use strict\";\n\nexport class Configuration {\n  constructor(options = {}) {\n    this.server = options.server || {\n      nodes: [\n        {\n          host: \"localhost\",\n          port: \"8108\",\n          path: \"\",\n          protocol: \"http\",\n        },\n      ],\n    };\n\n    this.server.cacheSearchResultsForSeconds = this.server.cacheSearchResultsForSeconds ?? 2 * 60;\n\n    this.additionalSearchParameters = options.additionalSearchParameters ?? {};\n\n    this.additionalSearchParameters.query_by =\n      this.additionalSearchParameters.queryBy ?? this.additionalSearchParameters.query_by ?? \"\";\n\n    this.additionalSearchParameters.preset =\n      this.additionalSearchParameters.preset ?? this.additionalSearchParameters.preset ?? \"\";\n\n    this.additionalSearchParameters.sort_by =\n      this.additionalSearchParameters.sortBy ?? this.additionalSearchParameters.sort_by ?? \"\";\n\n    this.additionalSearchParameters.highlight_full_fields =\n      this.additionalSearchParameters.highlightFullFields ??\n      this.additionalSearchParameters.highlight_full_fields ??\n      this.additionalSearchParameters.query_by;\n\n    this.geoLocationField = options.geoLocationField ?? \"_geoloc\";\n    this.facetableFieldsWithSpecialCharacters = options.facetableFieldsWithSpecialCharacters ?? [];\n\n    this.collectionSpecificSearchParameters = options.collectionSpecificSearchParameters ?? {};\n\n    Object.keys(this.collectionSpecificSearchParameters).forEach((collection) => {\n      const params = this.collectionSpecificSearchParameters[collection];\n      params.query_by = params.queryBy ?? params.query_by;\n      params.preset = params.preset ?? params.preset;\n      params.sort_by = params.sortBy ?? params.sort_by;\n      params.highlight_full_fields =\n        params.highlightFullFields ??\n        params.highlight_full_fields ??\n        this.additionalSearchParameters.highlight_full_fields ??\n        params.query_by;\n\n      // Remove undefined values\n      Object.keys(params).forEach((key) => (params[key] === undefined ? delete params[key] : {}));\n    });\n\n    this.renderingContent = options.renderingContent;\n    this.flattenGroupedHits = options.flattenGroupedHits ?? true;\n    this.facetByOptions = options.facetByOptions ?? {};\n    this.filterByOptions = options.filterByOptions ?? {};\n    this.sortByOptions = options.sortByOptions ?? {};\n    this.collectionSpecificFacetByOptions = options.collectionSpecificFacetByOptions ?? {};\n    this.collectionSpecificFilterByOptions = options.collectionSpecificFilterByOptions ?? {};\n    this.collectionSpecificSortByOptions = options.collectionSpecificSortByOptions ?? {};\n    this.union = options.union ?? false;\n    // For Typesense v30+, use curation_tags. Set to true for older versions that use override_tags.\n    this.useOverrideTags = options.useOverrideTags ?? false;\n    // When enabled, flips negative refinement encoding between AND/OR groups:\n    // AND groups become field:![a,b], OR groups become field:!a || field:!b\n    this.flipNegativeRefinementOperator = options.flipNegativeRefinementOperator ?? false;\n  }\n\n  validate() {\n    // Warn if camelCased parameters are used, suggest using snake_cased parameters instead\n    if (\n      this.additionalSearchParameters.queryBy ||\n      Object.values(this.collectionSpecificSearchParameters).some((c) => c.queryBy)\n    ) {\n      console.warn(\n        \"[typesense-instantsearch-adapter] Please use snake_cased versions of parameters in additionalSearchParameters instead of camelCased parameters. For example: Use query_by instead of queryBy. camelCased parameters will be deprecated in a future version.\" +\n          \" We're making this change so that parameter names are identical to the ones sent to Typesense (which are all snake_cased), and to also keep the types for these parameters in sync with the types defined in typesense-js.\",\n      );\n    }\n\n    /*\n     * Either additionalSearchParameters.query_by or additionalSearchParameters.preset needs to be set, or\n     *   All collectionSpecificSearchParameters need to have query_by or preset\n     *\n     * */\n    if (\n      this.additionalSearchParameters.query_by.length === 0 &&\n      this.additionalSearchParameters.preset.length === 0 &&\n      (Object.keys(this.collectionSpecificSearchParameters).length === 0 ||\n        Object.values(this.collectionSpecificSearchParameters).some(\n          (c) => (c.query_by || \"\").length === 0 && (c.preset || \"\").length === 0,\n        ))\n    ) {\n      throw new Error(\n        \"[typesense-instantsearch-adapter] Missing parameter: One of additionalSearchParameters.query_by or additionalSearchParameters.preset needs to be set, or all collectionSpecificSearchParameters need to have either .query_by or .preset set.\",\n      );\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}